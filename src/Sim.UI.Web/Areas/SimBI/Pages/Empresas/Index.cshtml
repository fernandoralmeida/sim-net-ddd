@page
@model Sim.UI.Web.Areas.SimBI.Pages.Empresas.IndexModel

@{
    Layout = "_Layout.cshtml";
    ViewData["Title"] = "Index";
}

<partial name="_StatusMessage" model="Model.StatusMessage" />

<div class="row">

    <ul class="collapsible popout">
        @{
            var ativo = "active";
        }

        @foreach (var emp in Model.ListEmpresas)
        {

            <li class="@ativo">

                @{ ativo = string.Empty; }
                

                <div class="collapsible-header waves-effect waves-green">@emp.Empresas.Key<span class="new badge blue" data-badge-caption="@emp.Empresas.Value">Estabelecimentos</span></div>
                <div class="collapsible-body white">
                    <div class="row">
                        <div class="col l6 m6 s12">
                            <ul class="collection z-depth-1">
                                <li class="collection-item"><i class="material-icons left">local_activity</i>Empresas por Setores</li>

                                @foreach (var op in emp.ListaSetores)
                                {

                                        <li class="collection-item"><span class="new badge " data-badge-caption="@op.Value"></span>@op.Key</li>

                                }

                            </ul>
                            <p></p>
                            <ul class="collection z-depth-1">
                                <li class="collection-item"><i class="material-icons left">analytics</i>Situação das empresas</li>

                                @foreach (var op in emp.ListaSituacao)
                                {


                                        <li class="collection-item"><span class="new badge blue lighten-2" data-badge-caption="@op.Value"></span>@op.Key</li>

                                }

                            </ul>
                            <p></p>
                        </div>
                        <div class="col l6 m6 s12 ">
                            <ul class="collection z-depth-1">
                                <li class="collection-item"><i class="material-icons left">handyman</i>Principais atividades (10+)</li>

                                @{int v = 0;}

                                @foreach (var op in emp.ListaAtividades)
                                {
                                    if (v < 10)
                                    {
                                        <li class="collection-item"><span class="new badge green lighten-1" data-badge-caption="@op.Value"></span>@op.Key</li>
                                    }
                                    else
                                    {
                                        break;
                                    }
                                    v++;
                                }

                            </ul>
                        </div>                            
                    </div>
                </div>
            </li>
        }

    <li>
        <div class="collapsible-header waves-effect waves-green">Empresas por CNAE</div>
        <div class="collapsible-body white">
            <div class="row">
                <ul class="collapsible">
                    <li>
                        <div class="collapsible-header">01 .. 03 AGRICULTURA, PECUÁRIA, PRODUÇÃO FLORESTAL, PESCA E AQÜICULTURA</div>
                        <div class="collapsible-body">
                            <div class="row">
                                <ul class="collapsible">
                                    <li>
                                        <div class="collapsible-header">01 AGRICULTURA, PECUÁRIA E SERVIÇOS RELACIONADOS</div>
                                        <div class="collapsible-body">
                                            <ul class="collapsible">
                                                <li>
                                                    <div class="collapsible-header">01.1 Produção de lavouras temporárias</div>
                                                    <div class="collapsible-body">
                                                        <ul class="collapsible">
                                                            <li>
                                                                <div class="collapsible-header">01.11-3 Cultivo de cereais</div>
                                                                <div class="collapsible-body">
                                                                    <ul class="collection">
                                                                        <li class="collection-item">0111-3/01 Cultivo de arroz</li>
                                                                    </ul>
                                                                </div>
                                                            </li>
                                                        </ul>
                                                    </div>
                                                </li>
                                            </ul>
                                        </div>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </li>
                </ul>
            </div>
        </div>
    </li>
    </ul>
</div>

<!-- Modal Structure -->
<div id="viewmodal" class="modal modal-fixed-footer">
    <div class="modal-content">
        <ul class="collection showcollection"></ul>
    </div>
    <div class="modal-footer">
        <a href="#!" class="modal-close btn waves-effect">Fechar</a>
    </div>
</div>

@section scripts{
    <script>
        $(function () {
            $(".modal-trigger").click(function () {
                var customerId = $(this).data('id');
                $(".showcollection").empty();
                $.getJSON(`/SimBI/Atendimentos?id=${customerId}&handler=Preview`, (data) => {
                    $.each(data, function (i, item) {
                        $(".showcollection").append(`<li class="collection-item"><span class="new badge green lighten-1" data-badge-caption="${item.value}"></span>${item.key}</li>`);
                    });
                });

            });
        });
    </script>
}